<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ø´Ø§Ù‚Ø© Ø¨Ù„Ø³ | Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --bg: #f8f9fa;
            --card: #ffffff;
            --text: #333;
            --input-bg: #fff;
        }

        [data-theme="dark"] {
            --bg: #121212;
            --card: #1e1e1e;
            --text: #e0e0e0;
            --input-bg: #2d2d2d;
            --secondary: #64b5f6;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: var(--bg); 
            color: var(--text);
            margin: 0; padding: 20px;
            transition: 0.3s ease;
        }

        .container { 
            max-width: 850px; margin: auto; 
            background: var(--card); 
            padding: 30px; border-radius: 25px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .theme-toggle {
            background: var(--primary); color: white; border: none; padding: 8px 15px;
            border-radius: 20px; cursor: pointer; font-weight: bold;
        }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: var(--card); border: 1px solid rgba(128, 128, 128, 0.2); padding: 20px; border-radius: 20px; }
        input { width: 90%; padding: 12px; margin: 10px 0; background: var(--input-bg); color: var(--text); border: 1px solid #555; border-radius: 12px; outline: none; }
        button { width: 100%; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; color: white; }
        .btn-main { background: var(--primary); }
        .btn-calc { background: #ff9800; margin-top: 10px; }
        .award-badge { font-size: 40px; margin: 5px; display: inline-block; }
        .log-item { background: rgba(76, 175, 80, 0.1); padding: 12px; margin: 8px 0; border-radius: 12px; display: flex; justify-content: space-between; }
        #result-box { margin-top: 15px; padding: 10px; border-radius: 10px; background: rgba(33, 150, 243, 0.1); }
        @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ / Ø¯Ø®ÙˆÙ„ -->
<div class="container" id="authContainer">
    <h2 style="text-align:center;">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>

    <div id="registerBox" style="display:block; margin-bottom:20px;">
        <h3>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
        <input type="text" id="regUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input type="password" id="regPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <input type="password" id="regConfirm" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn-main" onclick="registerUser()">ØªØ³Ø¬ÙŠÙ„</button>
        <p style="font-size:0.8rem;">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <span style="color:blue;cursor:pointer;" onclick="showLogin()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span></p>
        <div id="regMsg" style="color:red; font-size:0.9rem;"></div>
    </div>

    <div id="loginBox" style="display:none;">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
        <input type="text" id="loginUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input type="password" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn-main" onclick="loginUser()">Ø¯Ø®ÙˆÙ„</button>
        <p style="font-size:0.8rem;">Ù„Ø§ ØªÙ…Ù„Ùƒ Ø­Ø³Ø§Ø¨ØŸ <span style="color:blue;cursor:pointer;" onclick="showRegister()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</span></p>
        <div id="loginMsg" style="color:red; font-size:0.9rem;"></div>
    </div>
</div>

<!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div class="container" id="mainContent" style="display:none;">
    <header>
        <h1>Ø±Ø´Ø§Ù‚Ø© Ø¨Ù„Ø³ ğŸ</h1>
        <div>
            <button class="theme-toggle" onclick="toggleTheme()">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ/Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ</button>
            <button class="btn-main" style="background:#f44336; margin-left:10px;" onclick="logoutUser()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>
    </header>

    <div class="grid">
        <div class="card">
            <h3>ğŸ§® Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø³Ø¹Ø±Ø§Øª</h3>
            <p style="font-size: 0.8rem;">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ²Ù†</p>
            <input type="number" id="calc-weight" placeholder="Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙƒØ¬Ù…)">
            <button class="btn-calc" onclick="calculateCalories()">Ø§Ø­Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬ÙŠ</button>
            <div id="result-box" style="display:none;">
                <small>ØªØ­ØªØ§Ø¬ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ Ø¥Ù„Ù‰:</small>
                <div id="calorie-result" style="font-weight: bold; font-size: 1.2rem;"></div>
                <small>Ø³Ø¹Ø±Ø© Ø­Ø±Ø§Ø±ÙŠØ©/ÙŠÙˆÙ…</small>
            </div>
        </div>

        <div class="card">
            <h3>ğŸ“‰ ØªØªØ¨Ø¹ Ø§Ù„ÙˆØ²Ù†</h3>
            <input type="number" id="weight" placeholder="Ø³Ø¬Ù„ ÙˆØ²Ù† Ø§Ù„ÙŠÙˆÙ… (ÙƒØ¬Ù…)">
            <button class="btn-main" onclick="updateProgress()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ</button>
        </div>
    </div>

    <div class="card" style="margin-top: 20px; text-align: center;">
        <h3>ğŸ† Ø®Ø²Ø§Ù†Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</h3>
        <div id="awardsList"></div>
    </div>

    <canvas id="weightChart"></canvas>

    <div class="card" style="margin-top: 20px;">
        <h3>ğŸ± Ø³Ø¬Ù„ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª ÙˆØ§Ù„Ø³Ø¹Ø±Ø§Øª</h3>
        <div style="display: flex; gap: 10px;">
            <input type="text" id="foodInput" placeholder="Ø§Ø³Ù… Ø§Ù„ÙˆØ¬Ø¨Ø©">
            <input type="number" id="calInput" placeholder="Ø§Ù„Ø³Ø¹Ø±Ø§Øª">
        </div>
        <button class="btn-main" onclick="addMeal()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ø¬Ù„</button>
        <div id="mealLog" style="margin-top: 15px;"></div>
    </div>
</div>

<script>
    // ============================================
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰
    let users = JSON.parse(localStorage.getItem('users')) || [];
    let weightData = JSON.parse(localStorage.getItem('weightHistory')) || [];
    let meals = JSON.parse(localStorage.getItem('meals')) || [];
    let chart;

    // ==================== ØªØ³Ø¬ÙŠÙ„ / Ø¯Ø®ÙˆÙ„ ====================
    function showLogin() {
        document.getElementById('registerBox').style.display = 'none';
        document.getElementById('loginBox').style.display = 'block';
    }

    function showRegister() {
        document.getElementById('registerBox').style.display = 'block';
        document.getElementById('loginBox').style.display = 'none';
    }

    function registerUser() {
        const username = document.getElementById('regUsername').value.trim();
        const password = document.getElementById('regPassword').value;
        const confirm = document.getElementById('regConfirm').value;
        const msg = document.getElementById('regMsg');

        if(!username || !password || !confirm) {
            msg.style.color = 'red';
            msg.innerText = "ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„";
            return;
        }
        if(password !== confirm) {
            msg.style.color = 'red';
            msg.innerText = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØªØ£ÙƒÙŠØ¯Ù‡Ø§ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ÙŠÙ†";
            return;
        }
        if(users.some(u => u.username === username)) {
            msg.style.color = 'red';
            msg.innerText = "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„";
            return;
        }

        users.push({ username, password });
        localStorage.setItem('users', JSON.stringify(users));
        msg.style.color = 'green';
        msg.innerText = "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†.";
        document.getElementById('regUsername').value = '';
        document.getElementById('regPassword').value = '';
        document.getElementById('regConfirm').value = '';
    }

    function loginUser() {
        const username = document.getElementById('loginUsername').value.trim();
        const password = document.getElementById('loginPassword').value;
        const msg = document.getElementById('loginMsg');

        const user = users.find(u => u.username === username);
        if(!user) {
            msg.innerText = "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";
            return;
        }
        if(user.password !== password) {
            msg.innerText = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©";
            return;
        }

        // Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­
        localStorage.setItem('currentUser', username); // Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
        showMainContent();
    }

    function logoutUser() {
        localStorage.removeItem('currentUser');
        location.reload(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ø¹Ø±Ø¶ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    }

    function showMainContent() {
        document.getElementById('authContainer').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        initChart();
        meals.forEach(displayMeal);
        checkAwards();
    }

    // ==================== Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ ====================
    function toggleTheme() {
        const body = document.body;
        if(body.getAttribute('data-theme') === 'dark') {
            body.removeAttribute('data-theme');
            localStorage.setItem('theme', 'light');
        } else {
            body.setAttribute('data-theme', 'dark');
            localStorage.setItem('theme', 'dark');
        }
    }

    // ==================== Ø§Ù„Ø³Ø¹Ø±Ø§Øª ====================
    function calculateCalories() {
        const w = document.getElementById('calc-weight').value;
        if(w) {
            const calories = Math.round(w * 30);
            document.getElementById('calorie-result').innerText = calories;
            document.getElementById('result-box').style.display = 'block';
        }
    }

    // ==================== Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ ====================
    function initChart() {
        const ctx = document.getElementById('weightChart').getContext('2d');
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: weightData.map((_, i) => `ÙŠÙˆÙ… ${i+1}`),
                datasets: [{
                    label: 'Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)',
                    data: weightData,
                    borderColor: '#4CAF50',
                    tension: 0.3,
                    fill: false
                }]
            },
            options: { responsive: true }
        });
    }

    function updateProgress() {
        const w = document.getElementById('weight').value;
        if(w) {
            weightData.push(w);
            localStorage.setItem('weightHistory', JSON.stringify(weightData));
            chart.data.labels.push(`ÙŠÙˆÙ… ${weightData.length}`);
            chart.data.datasets[0].data.push(w);
            chart.update();
            checkAwards();
            document.getElementById('weight').value = '';
        }
    }

    // ==================== Ø³Ø¬Ù„ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª ====================
    function addMeal() {
        const food = document.getElementById('foodInput').value;
        const cal = document.getElementById('calInput').value;
        if(food && cal) {
            const meal = { food, cal };
            meals.push(meal);
            localStorage.setItem('meals', JSON.stringify(meals));
            displayMeal(meal);
            checkAwards();
            document.getElementById('foodInput').value = '';
            document.getElementById('calInput').value = '';
        }
    }

    function displayMeal(meal) {
        const div = document.createElement("div");
        div.className = "log-item";
        div.innerHTML = `<span><b>${meal.food}</b></span> <span>${meal.cal} Ø³Ø¹Ø±Ø©</span>`;
        document.getElementById('mealLog').prepend(div);
    }

    // ==================== Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª ====================
    function checkAwards() {
        const list = document.getElementById('awardsList');
        list.innerHTML = '';
        if (meals.length >= 1) list.innerHTML += '<span class="award-badge" title="Ø¨Ø¯Ø§ÙŠØ©">ğŸ¥—</span>';
        if (meals.length >= 5) list.innerHTML += '<span class="award-badge" title="Ù…Ø«Ø§Ø¨Ø±">ğŸ</span>';
        if (weightData.length >= 3) list.innerHTML += '<span class="award-badge" title="ØªØªØ¨Ø¹">ğŸ“‰</span>';
        if (weightData.length >= 10) list.innerHTML += '<span class="award-badge" title="Ø¨Ø·Ù„">ğŸ‘‘</span>';
    }

    // ==================== Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ====================
    window.onload = () => {
        if(localStorage.getItem('theme') === 'dark') toggleTheme();

        const loggedUser = localStorage.getItem('currentUser');
        if(loggedUser) {
            showMainContent();
        }
    };
</script>

</body>
</html>